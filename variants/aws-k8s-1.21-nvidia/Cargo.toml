[package]
# This is the aws-k8s-1.21-nvidia variant.  "." is not allowed in crate names, but we
# don't use this crate name anywhere.
name = "aws-k8s-1_21-nvidia"
version = "0.1.0"
edition = "2018"
publish = false
build = "build.rs"
# Don't rebuild crate just because of changes to README.
exclude = ["README.md"]

[package.metadata.build-variant.image-layout]
os-image-size-gib = 4

[package.metadata.build-variant]
included-packages = [
# core
    "kernel-5.10",
    "release",
# networking
    "wicked",
# k8s
    "aws-iam-authenticator",
    "cni",
    "cni-plugins",
    "kubelet-1.21",
# NVIDIA
    "nvidia-container-toolkit",
    "nvidia-k8s-device-plugin",
    "kmod-5.10-nvidia-tesla-470",
]
kernel-parameters = [
    "console=tty0",
    "console=ttyS0,115200n8",
    "net.ifnames=0",
    "netdog.default-interface=eth0:dhcp4,dhcp6?",
    "quiet",
]

[lib]
path = "lib.rs"

[build-dependencies]
# core
kernel-5_10 = { path = "../../packages/kernel-5.10" }
release = { path = "../../packages/release" } 
# networking
wicked = { path = "../../packages/wicked" }
# k8s
aws-iam-authenticator = { path = "../../packages/aws-iam-authenticator" }
cni = { path = "../../packages/cni" }
cni-plugins = { path = "../../packages/cni-plugins" }
kubernetes-1_21 = { path = "../../packages/kubernetes-1.21" }
# NVIDIA
nvidia-container-toolkit = { path = "../../packages/nvidia-container-toolkit" }
nvidia-k8s-device-plugin = { path = "../../packages/nvidia-k8s-device-plugin" }
kmod-5_10-nvidia = { path = "../../packages/kmod-5.10-nvidia" }
